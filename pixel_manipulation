from PIL import Image
import numpy as np

def encrypt_decrypt_image(image_path, key):
    try:
        #  the image
        img = Image.open(image_path)

        #  image to a NumPy array (pixels as numbers)
        img_array = np.array(img)

        # XOR to every pixel value with the key
        encrypted_array = np.bitwise_xor(img_array, key)

        # modified array back into an image
        return Image.fromarray(encrypted_array)

    except Exception as error:
        print(f"[Error] Couldn't process image: {error}")
        return None




if __name__ == "__main__":
    
    key = 128

    
    input_image = "rose.jpg"

    # Encrypt the original image
    encrypted_img = encrypt_decrypt_image(input_image, key)
    if encrypted_img:
        encrypted_img.save("rose_encrypted.jpg")
        print("✅ Image encrypted and saved as 'rose_encrypted.jpg'")

    # Decrypt the encrypted image
    decrypted_img = encrypt_decrypt_image("rose_encrypted.jpg", key)
    if decrypted_img:
        decrypted_img.save("rose_decrypted.jpg")
        print("✅ Image decrypted and saved as 'rose_decrypted.jpg'")